<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Book Category Generator</title>
  
  <link rel="stylesheet" href="style1.css"> 
  
</head>
<body>

  <div class="card">
    <h2>üìö Favorite Book Category</h2>
    <p>Choose a category you like:</p>

    <input type="button" name="category" value="Science Fiction" onclick="selectCategory(this)">
    <input type="button" name="category" value="Mystery" onclick="selectCategory(this)">
    <input type="button" name="category" value="Romance" onclick="selectCategory(this)">
    <input type="button" name="category" value="Fantasy" onclick="selectCategory(this)">

    <button class="finishBtn" id="btnFinish" onclick="finish()">Finish</button>
  </div>

  <script>
    // ******************************************************
    // URL ‡∏Ç‡∏≠‡∏á Google Apps Script (‡πÉ‡∏™‡πà Link ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà)
    const scriptURL = 'https://script.google.com/macros/s/AKfycbw0HXbCaUjhV1nIw5x3MBZbosdOelH4isIgb2Cht7hU8lCSNtBbUnRvXzKHYx868FI4zg/exec'; 
    // ******************************************************

    let selectedValue = ""; 

    function selectCategory(btn) {
        let buttons = document.getElementsByName('category');
        buttons.forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        selectedValue = btn.value;
    }

    function finish() {
        if (selectedValue === "") {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö!");
            return;
        }

        const btn = document.getElementById('btnFinish');
        btn.innerText = "Saving...";
        btn.disabled = true;

        const userEmail = localStorage.getItem('userEmail');

        if (!userEmail) {
            alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà");
            window.location.href = "../loginpage/index.html"; 
            return;
        }

        const data = {
            action: 'updateCategory', 
            email: userEmail,         
            category: selectedValue   
        };

        fetch(scriptURL, {
            method: 'POST',
            body: JSON.stringify(data),
            mode: 'no-cors'
        })
        .then(() => {
            alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
            window.location.href = "../homepage/home.html";
        })
        .catch(error => {
            console.error('Error!', error.message);
            alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠");
            btn.innerText = "Finish";
            btn.disabled = false;
        });
    }
  </script>

</body>
</html>