<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="style.css" />
    <title>ChaoNungSue - Home</title>
  </head>

  <body>
    <div class="navbar">
      <h2>ChaoNungSue</h2>
      
      <div class="search-container">
        <input type="text" id="searchInput" placeholder="ค้นหาหนังสือหรือชื่อผู้เขียน..." onkeyup="searchBooks()">
        <i class='bx bx-search'></i>
      </div>

      <ul>
        <li><a href="#">Home</a></li>
        <li><a href="#">Skills</a></li>
        <li><a href="#">Contact</a></li>
      </ul>
      <button class="hire-btn" onclick="login()">Login</button>
    </div>

    <div id="hero-section">
      <div class="main">
        <h4>Welcome to ChaoNungSue</h4>
        <p class="title">Your Virtual Library</p>
        <p class="subtitle">Borrow books of your interests, or just take a look around!</p>
      </div>
    </div>

    <div class="content-container">
      <div class="section-header">
        <h2 id="displayTitle">Recommended Books</h2>
        <span id="resultCount" style="color: #666; font-size: 14px;"></span>
      </div>

      <div class="book-grid" id="bookDisplay">
        </div>
    </div>

    <script>
      let allBooks = [];

      // โหลดข้อมูลจากไฟล์ CSV
      async function fetchBooks() {
        try {
          const response = await fetch('books.csv');
          const data = await response.text();
          const rows = data.split('\n').slice(1); // ข้ามหัวตาราง

          allBooks = rows.map(row => {
            const cols = row.split(',');
            if (cols.length >= 2) {
              return {
                title: cols[0].trim(),
                author: cols[1].trim(),
                rating: cols[2]?.trim() || "0",
                img: cols[3]?.trim() || "https://via.placeholder.com/200x300?text=No+Cover"
              };
            }
            return null;
          }).filter(b => b !== null);

          displayBooks(allBooks);
        } catch (error) {
          console.error("Error loading CSV:", error);
          document.getElementById('bookDisplay').innerHTML = "<p>กรุณารันผ่าน Live Server เพื่อโหลดข้อมูล</p>";
        }
      }

      // แสดงผลหนังสือใน Grid
      function displayBooks(books) {
        const container = document.getElementById('bookDisplay');
        container.innerHTML = '';
        
        books.forEach(book => {
          container.innerHTML += `
            <div class="book-card">
              <div class="thumbnail">
                <img src="${book.img}" onerror="this.src='https://via.placeholder.com/200x300?text=Book'">
              </div>
              <div class="book-info">
                <h3 class="book-title">${book.title}</h3>
                <p class="book-author">${book.author}</p>
                <p class="book-stats">Rating: ${book.rating}</p>
              </div>
            </div>
          `;
        });
      }

      // ฟังก์ชันค้นหา
      function searchBooks() {
        const term = document.getElementById('searchInput').value.toLowerCase();
        const filtered = allBooks.filter(book => 
          book.title.toLowerCase().includes(term) || 
          book.author.toLowerCase().includes(term)
        );
        
        displayBooks(filtered);
        document.getElementById('displayTitle').innerText = term ? `Search Results` : "Recommended Books";
        document.getElementById('resultCount').innerText = term ? `(${filtered.length} found)` : "";
      }

      function login() { window.location.href = "../loginpage/login.html"; }
      window.onload = fetchBooks;
    </script>
  </body>
</html>